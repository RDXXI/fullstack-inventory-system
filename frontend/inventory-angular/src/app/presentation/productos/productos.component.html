<mat-toolbar color="primary" class="toolbar">Gestión de Productos</mat-toolbar>

<div class="container">
  <form [formGroup]="filterForm" class="filters" (ngSubmit)="onFilter()">
    <mat-form-field appearance="outline">
      <mat-label>Nombre</mat-label>
      <input matInput placeholder="Buscar por nombre" formControlName="nombre" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Categoría</mat-label>
      <input matInput placeholder="Buscar por categoría" formControlName="categoria" />
    </mat-form-field>

    <div class="actions">
      <button mat-raised-button color="primary" type="submit">Filtrar</button>
      <button mat-stroked-button type="button" (click)="clearFilter()">Limpiar</button>
      <button mat-flat-button color="accent" type="button" (click)="abrirFormulario()">
        + Nuevo
      </button>
    </div>
  </form>

  <div *ngIf="loading" class="loading">Cargando...</div>

  <div class="grid" *ngIf="!loading && productos.length > 0; else sinProductos">
    <mat-card *ngFor="let p of productos" class="card">
      <img mat-card-image [src]="p.imagenUrl || 'assets/default.jpg'" [alt]="p.nombre" />
      <mat-card-title>{{ p.nombre }}</mat-card-title>
      <mat-card-content>
        <p class="descripcion">{{ p.descripcion }}</p>
        <div class="info">
          <span><strong>Precio:</strong> ${{ p.precio }}</span>
          <span><strong>Stock:</strong> {{ p.stock }}</span>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-stroked-button color="primary" (click)="editarProducto(p)">Editar</button>
      </mat-card-actions>
    </mat-card>
  </div>

  <ng-template #sinProductos>
    <p class="no-results">No se encontraron productos.</p>
  </ng-template>

  <mat-paginator
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPageChange($event)"
  ></mat-paginator>

  <div class="modal" *ngIf="showForm">
    <div class="modal-content">
      <h2>{{ editando ? 'Editar Producto' : 'Nuevo Producto' }}</h2>

      <form [formGroup]="productoForm" (ngSubmit)="guardarProducto()">
        <mat-form-field appearance="outline">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Descripción</mat-label>
          <textarea matInput formControlName="descripcion" required></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Categoría</mat-label>
          <input matInput formControlName="categoria" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Imagen URL</mat-label>
          <input matInput formControlName="imagenUrl" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Precio</mat-label>
          <input matInput type="number" formControlName="precio" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Stock</mat-label>
          <input matInput type="number" formControlName="stock" required />
        </mat-form-field>

        <div class="modal-actions">
          <button mat-flat-button color="primary" type="submit">
            {{ editando ? 'Actualizar' : 'Guardar' }}
          </button>
          <button mat-stroked-button type="button" (click)="cerrarFormulario()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>
